{"version":3,"sources":["virtuallist.js","App.js","index.js"],"names":["Item1","props","this","cacheOffset","node","index","data","className","ref","Component","Virtuallist","top","getBoundingClientRect","window","pageYOffset","cache","push","bottom","height","console","log","handleScroll","scrollTop","scrollY","updateIndex","updateView","start","end","state","countData","topOffset","btmOffset","vData","Array","fill","anchor","count","Math","ceil","innerHeight","addEventListener","find","item","slice","setState","length","style","paddingTop","paddingBottom","map","key","PureComponent","App","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"qQACMA,E,kDACJ,WAAYC,GAAQ,uCACZA,G,gEAINC,KAAKD,MAAME,YAAYD,KAAKE,KAAMF,KAAKD,MAAMI,S,+BAIrC,IAAD,SACiBH,KAAKD,MAArBI,EADD,EACCA,MAAOC,EADR,EACQA,KACf,OACE,yBAAKC,UAAU,YAAYC,IAAK,SAAAJ,GAAI,OAAE,EAAKA,KAAKA,IAC9C,8BAAOC,EAAP,IAAeC,GACf,8BAAOD,EAAP,iC,GAfYI,aAsBCC,E,kDACnB,WAAYT,GAAQ,IAAD,8BACjB,cAAMA,IAoBRE,YAAc,SAACC,EAAMC,GACnB,IACMM,EADOP,EAAKQ,wBACDD,IAAME,OAAOC,YAC9B,EAAKC,MAAMC,KAAK,CACdX,QACAM,IAAKA,EACLM,OAAQN,EAAI,EAAKO,SAEnBC,QAAQC,IAAI,QAAQ,EAAKL,QA7BR,EAuCnBM,aAAe,WACb,IAAMC,EAAYT,OAAOU,QACzBJ,QAAQC,IAAI,YAAaE,GACzB,EAAKE,YAAYF,GACjB,EAAKG,aACL,EAAKH,UAAYA,GA1CjB,EAAKJ,OAAS,GACd,EAAKQ,MAAQ,EACb,EAAKC,IAAM,EACX,EAAKC,MAAQ,CACXC,UAAW,GACXC,UAAW,EACXC,UAAW,GAEb,EAAKC,MAAQ,IAAIC,MAAM,KAAKC,KAAK,OAEjC,EAAKnB,MAAQ,GACb,EAAKoB,OAAS,CACZ9B,MAAO,EACPM,IAAK,EACLM,OAAQ,GAhBO,E,gEAgCjBf,KAAKkC,MAAQC,KAAKC,KAAKzB,OAAO0B,YAAYrC,KAAKgB,QAC/ChB,KAAKyB,IAAMzB,KAAKwB,MAAQxB,KAAKkC,MAE7BlC,KAAKuB,aACLZ,OAAO2B,iBAAiB,SAAUtC,KAAKmB,cAAa,K,kCAY1CC,GACV,IAAMa,EAASjC,KAAKa,MAAM0B,MAAK,SAAAC,GAAI,OAAEA,EAAKzB,QAAQK,KAClDH,QAAQC,IAAI,QAAQlB,KAAKa,MAAOoB,GAChCjC,KAAKiC,OAAL,eAAkBA,GAClBjC,KAAKwB,MAAQxB,KAAKiC,OAAO9B,MACzBH,KAAKyB,IAAMzB,KAAKwB,MAAQxB,KAAKkC,Q,mCAK7BjB,QAAQC,IAAI,QAAQlB,KAAKwB,MAAMxB,KAAKyB,KACpC,IAAME,EAAY3B,KAAK8B,MAAMW,MAAMzC,KAAKwB,MAAOxB,KAAKyB,KACpDR,QAAQC,IAAI,YAAYS,GACxB3B,KAAK0C,SAAS,CACZd,UAAU5B,KAAKiC,OAAOxB,IACtBoB,WAAW7B,KAAK8B,MAAMa,OAAO3C,KAAKyB,KAAKzB,KAAKgB,OAC5CW,gB,+BAKM,IAAD,SACoC3B,KAAK0B,MAAxCC,EADD,EACCA,UAAWE,EADZ,EACYA,UAAUD,EADtB,EACsBA,UAE7B,OADAX,QAAQC,IAAI,YAAaS,GAEvB,yBAAKtB,UAAU,kBAAkBuC,MAAO,CAACC,WAAW,GAAD,OAAIjB,EAAJ,MAAkBkB,cAAc,GAAD,OAAIjB,EAAJ,QAC/EF,EAAUoB,KAAI,SAAC3C,EAAMD,GAAP,OACb,kBAAC,EAAD,CAAO6C,IAAK7C,EAAOC,KAAMA,EAAMD,MAAO,EAAKqB,MAAMrB,EAAOF,YAAa,EAAKA,sB,GA5E3CgD,iBClBpBC,E,kDAInB,WAAYnD,GAAQ,IAAD,8BACjB,cAAMA,IAED2B,MAAQ,GAHI,E,qDAUjB,OACE,yBAAKrB,UAAU,OACb,kBAAC,EAAD,W,GAhByBE,aCDjC4C,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,EAAD,OAEFC,SAASC,eAAe,U","file":"static/js/main.446a6d43.chunk.js","sourcesContent":["import React, { PureComponent, Component } from 'react'\nclass Item1 extends Component {\n  constructor(props) {\n    super(props)\n  }\n\n  componentDidMount() {\n    this.props.cacheOffset(this.node, this.props.index)\n\n  }\n\n  render() {\n    const { index, data } = this.props\n    return (\n      <div className='list-item' ref={node=>this.node=node}>\n        <span>{index}.{data}</span>\n        <span>{index}测试数据</span>\n      </div>\n    )\n  }\n}\n\n\nexport default class Virtuallist extends PureComponent {\n  constructor(props) {\n    super(props)\n    this.height = 50  // 单个元素的固定高度\n    this.start = 0 //页面上开始元素的index\n    this.end = 0 //\n    this.state = {\n      countData: [],\n      topOffset: 0,  // 为了使滚动条看起来正常的一点\n      btmOffset: 0\n    }\n    this.vData = new Array(500).fill('kkb')\n\n    this.cache = []\n    this.anchor = {  // 锚点，可见页面开始的标志\n      index: 0,\n      top: 0,\n      bottom: 0\n    }\n  }\n\n  //缓存子元素的位置信息，以免重复计算\n  cacheOffset = (node, index) => {\n    const rect = node.getBoundingClientRect();\n    const top = rect.top + window.pageYOffset\n    this.cache.push({\n      index,\n      top: top,\n      bottom: top+this.height\n    })\n    console.log('cache',this.cache)\n  }\n  componentDidMount() {\n    this.count = Math.ceil(window.innerHeight/this.height)\n    this.end = this.start + this.count\n\n    this.updateView() \n    window.addEventListener('scroll', this.handleScroll,false)\n  }\n\n  handleScroll = () => {\n    const scrollTop = window.scrollY\n    console.log('scrollTop', scrollTop)\n    this.updateIndex(scrollTop)\n    this.updateView()\n    this.scrollTop = scrollTop\n\n  }\n  // 获取开始元素的索引\n  updateIndex(scrollTop) {\n    const anchor = this.cache.find(item=>item.bottom>=scrollTop)\n    console.log('cache',this.cache, anchor)\n    this.anchor = {...anchor}\n    this.start = this.anchor.index\n    this.end = this.start + this.count\n  }\n\n  // 计算可视区域可以显示的图片数量\n  updateView() {\n    console.log('start',this.start,this.end)\n    const countData = this.vData.slice(this.start, this.end)\n    console.log('countData',countData)\n    this.setState({\n      topOffset:this.anchor.top,\n      btmOffset:(this.vData.length-this.end)*this.height,\n      countData,\n    })\n  } \n\n\n  render() {\n    const { countData, btmOffset,topOffset } = this.state;\n    console.log('countData', countData)\n    return (\n      <div className='virtual-wrapper' style={{paddingTop:`${topOffset}px`,paddingBottom:`${btmOffset}px`}}>\n        {countData.map((data, index) =>\n          <Item1 key={index} data={data} index={this.start+index} cacheOffset={this.cacheOffset}></Item1>\n        )}\n      </div>\n    )\n  }\n}\n","import React, { Component } from 'react'\nimport './App.css';\nimport VirtualList from './virtuallist'\nimport PropTypes from 'prop-types'\n\nexport default class App extends Component {\n  static propTypes = {\n\n  }\n  constructor(props) {\n    super(props)\n  \n    this.state = {\n       \n    }\n  }\n  \n\n  render() {\n    return (\n      <div className='app'>\n        <VirtualList></VirtualList>\n      </div>\n    )\n  }\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}